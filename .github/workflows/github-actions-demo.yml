name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - name: Setup Go Environment
        uses: actions/setup-go@v2
        with:
          go-version: 1.19.2
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
      - name: Print CWD
        run: echo "$PWD"
      - name: Install crio
        run: |
          export OS=xUbuntu_22.04
          export CRIO_VERSION=1.25
          echo "deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/ /"| sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list
          echo "deb http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable:/cri-o:/$CRIO_VERSION/$OS/ /"|sudo tee /etc/apt/sources.list.d/devel:kubic:libcontainers:stable:cri-o:$CRIO_VERSION.list
          
          curl -L https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable:cri-o:$CRIO_VERSION/$OS/Release.key | sudo apt-key add -
          curl -L https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/Release.key | sudo apt-key add -
      - name: Run apt command
        run: |
          sudo apt update
          sudo apt install cri-o cri-o-runc -y
      - name: Start crio
        run: |
          sudo systemctl start crio
          sudo systemctl enable crio
      - name: Check crio service
        run: sudo systemctl status crio
      - name: Git Clone microshift repo
        uses: sudosubin/git-clone-action@v1.0.1
        with:
          repository: openshift/microshift
          platform: github
          ref: 3db9e81
          path: tmp/microshift
      - name: List the contents of cloned repository
        run: ls 
        working-directory: ./tmp/microshift
      - name: Run make on the cloned repo
        run: go build
        working-directory: ./tmp/microshift/cmd/microshift
      - name: List the contents of cloned repository
        run: ls
        working-directory: ./tmp/microshift/cmd/microshift
      - name: Run the binary
        run: sudo ./microshift run --help
        working-directory: ./tmp/microshift/cmd/microshift
